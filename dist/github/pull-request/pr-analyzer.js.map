{
  "version": 3,
  "sources": ["../../../src/github/pull-request/pr-analyzer.ts"],
  "sourcesContent": ["import { Octokit, RepoContext } from \"../type/types\";\n\n/**\n * Get linked PRs from issue timeline\n *\n * Retrieves all pull requests that are cross-referenced in the issue timeline.\n * This includes PRs that mention the issue in their body, title, or comments.\n */\nexport async function getLinkedPRs(\n  octokit: Octokit,\n  context: RepoContext,\n  issueNumber: number\n): Promise<any[]> {\n  const { data: timeline } = await octokit.rest.issues.listEventsForTimeline({\n    owner: context.owner,\n    repo: context.repo,\n    issue_number: issueNumber,\n  });\n\n  // Filter for cross-referenced events that are pull requests (not regular issues)\n  return timeline.filter(\n    (event: any) =>\n      event.event === \"cross-referenced\" &&\n      event.source &&\n      event.source.type === \"issue\" &&\n      event.source.issue.pull_request\n  );\n}\n\n/**\n * Count merged PRs from linked PRs\n *\n * Counts how many of the linked PRs have actually been merged into the repository.\n * This is used to determine if an issue has sufficient merged PRs to be considered\n * \"in progress\" or potentially \"completed\".\n */\nexport async function countMergedPRs(\n  octokit: Octokit,\n  context: RepoContext,\n  linkedPRs: any[]\n): Promise<number> {\n  let mergedCount = 0;\n\n  for (const linkedPR of linkedPRs) {\n    const prNumber = linkedPR.source.issue.number;\n\n    const { data: prDetails } = await octokit.rest.pulls.get({\n      owner: context.owner,\n      repo: context.repo,\n      pull_number: prNumber,\n    });\n\n    if (prDetails.merged) {\n      mergedCount++;\n    }\n  }\n\n  return mergedCount;\n}\n\n/**\n * Check if any PR body references the issue\n *\n * This function verifies that merged PRs actually intended to resolve the issue\n * by checking if the PR body contains an explicit reference to the issue number (e.g., \"fixes #5\", \"closes #10\").\n *\n * Why this is needed:\n * - A PR might be linked to an issue via timeline cross-reference without actually fixing it\n * - Multiple PRs might be merged, but none of them actually address the specific issue\n * - This ensures completed issues were intentionally resolved, not just incidentally linked\n *\n * Example:\n * - Issue #5: \"Fix login bug\"\n * - PR #10: \"Refactor auth\" (merged, but no #5 reference) \u2192 Not a fix\n * - PR #11: \"Fix login bug closes #5\" (merged, with #5 reference) \u2192 Actual fix\n */\nexport async function hasIssueReferenceInPRs(\n  octokit: Octokit,\n  context: RepoContext,\n  issueNumber: number,\n  linkedPRs: any[]\n): Promise<boolean> {\n  for (const linkedPR of linkedPRs) {\n    const prNumber = linkedPR.source.issue.number;\n\n    const { data: prDetails } = await octokit.rest.pulls.get({\n      owner: context.owner,\n      repo: context.repo,\n      pull_number: prNumber,\n    });\n\n    // Use word boundary (\\b) to prevent partial matches (e.g., #50 should not match #5)\n    const issuePattern = new RegExp(`#${issueNumber}\\\\b`, \"i\");\n    if (prDetails.body && issuePattern.test(prDetails.body)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA,eAAsB,aACpB,SACA,SACA,aACgB;AAChB,QAAM,EAAE,MAAM,SAAS,IAAI,MAAM,QAAQ,KAAK,OAAO,sBAAsB;AAAA,IACzE,OAAO,QAAQ;AAAA,IACf,MAAM,QAAQ;AAAA,IACd,cAAc;AAAA,EAChB,CAAC;AAGD,SAAO,SAAS;AAAA,IACd,CAAC,UACC,MAAM,UAAU,sBAChB,MAAM,UACN,MAAM,OAAO,SAAS,WACtB,MAAM,OAAO,MAAM;AAAA,EACvB;AACF;AASA,eAAsB,eACpB,SACA,SACA,WACiB;AACjB,MAAI,cAAc;AAElB,aAAW,YAAY,WAAW;AAChC,UAAM,WAAW,SAAS,OAAO,MAAM;AAEvC,UAAM,EAAE,MAAM,UAAU,IAAI,MAAM,QAAQ,KAAK,MAAM,IAAI;AAAA,MACvD,OAAO,QAAQ;AAAA,MACf,MAAM,QAAQ;AAAA,MACd,aAAa;AAAA,IACf,CAAC;AAED,QAAI,UAAU,QAAQ;AACpB;AAAA,IACF;AAAA,EACF;AAEA,SAAO;AACT;AAkBA,eAAsB,uBACpB,SACA,SACA,aACA,WACkB;AAClB,aAAW,YAAY,WAAW;AAChC,UAAM,WAAW,SAAS,OAAO,MAAM;AAEvC,UAAM,EAAE,MAAM,UAAU,IAAI,MAAM,QAAQ,KAAK,MAAM,IAAI;AAAA,MACvD,OAAO,QAAQ;AAAA,MACf,MAAM,QAAQ;AAAA,MACd,aAAa;AAAA,IACf,CAAC;AAGD,UAAM,eAAe,IAAI,OAAO,IAAI,WAAW,OAAO,GAAG;AACzD,QAAI,UAAU,QAAQ,aAAa,KAAK,UAAU,IAAI,GAAG;AACvD,aAAO;AAAA,IACT;AAAA,EACF;AAEA,SAAO;AACT;",
  "names": []
}
